/*
 * EventEmitter2
 * https://github.com/hij1nx/EventEmitter2
 *
 * Copyright (c) 2013 hij1nx
 * Licensed under the MIT license.
 */
!function(a){function d(){this._events={},this._conf&&e.call(this,this._conf)}function e(a){a&&(this._conf=a,a.delimiter&&(this.delimiter=a.delimiter),a.maxListeners&&(this._events.maxListeners=a.maxListeners),a.wildcard&&(this.wildcard=a.wildcard),a.newListener&&(this.newListener=a.newListener),this.wildcard&&(this.listenerTree={}))}function f(a){this._events={},this.newListener=!1,e.call(this,a)}function g(a,b,c,d){if(!c)return[];var f,h,i,j,k,l,m,e=[],n=b.length,o=b[d],p=b[d+1];if(d===n&&c._listeners){if("function"===typeof c._listeners)return a&&a.push(c._listeners),[c];for(f=0,h=c._listeners.length;f<h;f++)a&&a.push(c._listeners[f]);return[c]}if("*"===o||"**"===o||c[o]){if("*"===o){for(i in c)"_listeners"!==i&&c.hasOwnProperty(i)&&(e=e.concat(g(a,b,c[i],d+1)));return e}if("**"===o){m=d+1===n||d+2===n&&"*"===p,m&&c._listeners&&(e=e.concat(g(a,b,c,n)));for(i in c)"_listeners"!==i&&c.hasOwnProperty(i)&&("*"===i||"**"===i?(c[i]._listeners&&!m&&(e=e.concat(g(a,b,c[i],n))),e=e.concat(g(a,b,c[i],d))):e=e.concat(i===p?g(a,b,c[i],d+2):g(a,b,c[i],d)));return e}e=e.concat(g(a,b,c[o],d+1))}if(j=c["*"],j&&g(a,b,j,d+1),k=c["**"])if(d<n){k._listeners&&g(a,b,k,n);for(i in k)"_listeners"!==i&&k.hasOwnProperty(i)&&(i===p?g(a,b,k[i],d+2):i===o?g(a,b,k[i],d+1):(l={},l[i]=k[i],g(a,b,{"**":l},d+1)))}else k._listeners?g(a,b,k,n):k["*"]&&k["*"]._listeners&&g(a,b,k["*"],n);return e}function h(a,d){a="string"===typeof a?a.split(this.delimiter):a.slice();for(var e=0,f=a.length;e+1<f;e++)if("**"===a[e]&&"**"===a[e+1])return;for(var g=this.listenerTree,h=a.shift();h;){if(g[h]||(g[h]={}),g=g[h],0===a.length){if(g._listeners){if("function"===typeof g._listeners)g._listeners=[g._listeners,d];else if(b(g._listeners)&&(g._listeners.push(d),!g._listeners.warned)){var i=c;"undefined"!==typeof this._events.maxListeners&&(i=this._events.maxListeners),i>0&&g._listeners.length>i&&(g._listeners.warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",g._listeners.length),console.trace&&console.trace())}}else g._listeners=d;return!0}h=a.shift()}return!0}var b=Array.isArray?Array.isArray:function(a){return"[object Array]"===Object.prototype.toString.call(a)},c=10;f.prototype.delimiter=".",f.prototype.setMaxListeners=function(a){this._events||d.call(this),this._events.maxListeners=a,this._conf||(this._conf={}),this._conf.maxListeners=a},f.prototype.event="",f.prototype.once=function(a,b){return this.many(a,1,b),this},f.prototype.many=function(a,b,c){function e(){0===--b&&d.off(a,e),c.apply(this,arguments)}var d=this;if("function"!==typeof c)throw new Error("many only accepts instances of Function");return e._origin=c,this.on(a,e),d},f.prototype.emit=function(){this._events||d.call(this);var a=arguments[0];if("newListener"===a&&!this.newListener&&!this._events.newListener)return!1;if(this._all){for(var b=arguments.length,c=new Array(b-1),e=1;e<b;e++)c[e-1]=arguments[e];for(e=0,b=this._all.length;e<b;e++)this.event=a,this._all[e].apply(this,c)}if("error"===a&&!this._all&&!this._events.error&&(!this.wildcard||!this.listenerTree.error))throw arguments[1]instanceof Error?arguments[1]:new Error("Uncaught, unspecified 'error' event.");var f;if(this.wildcard){f=[];var h="string"===typeof a?a.split(this.delimiter):a.slice();g.call(this,f,h,this.listenerTree,0)}else f=this._events[a];if("function"===typeof f){if(this.event=a,1===arguments.length)f.call(this);else if(arguments.length>1)switch(arguments.length){case 2:f.call(this,arguments[1]);break;case 3:f.call(this,arguments[1],arguments[2]);break;default:for(var b=arguments.length,c=new Array(b-1),e=1;e<b;e++)c[e-1]=arguments[e];f.apply(this,c)}return!0}if(f){for(var b=arguments.length,c=new Array(b-1),e=1;e<b;e++)c[e-1]=arguments[e];for(var i=f.slice(),e=0,b=i.length;e<b;e++)this.event=a,i[e].apply(this,c);return i.length>0||!!this._all}return!!this._all},f.prototype.on=function(a,e){if("function"===typeof a)return this.onAny(a),this;if("function"!==typeof e)throw new Error("on only accepts instances of Function");if(this._events||d.call(this),this.emit("newListener",a,e),this.wildcard)return h.call(this,a,e),this;if(this._events[a]){if("function"===typeof this._events[a])this._events[a]=[this._events[a],e];else if(b(this._events[a])&&(this._events[a].push(e),!this._events[a].warned)){var f=c;"undefined"!==typeof this._events.maxListeners&&(f=this._events.maxListeners),f>0&&this._events[a].length>f&&(this._events[a].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),console.trace&&console.trace())}}else this._events[a]=e;return this},f.prototype.onAny=function(a){if("function"!==typeof a)throw new Error("onAny only accepts instances of Function");return this._all||(this._all=[]),this._all.push(a),this},f.prototype.addListener=f.prototype.on,f.prototype.off=function(c,d){function n(b){if(b!==a){var c=Object.keys(b);for(var d in c){var e=c[d],f=b[e];f instanceof Function||"object"!==typeof f||(Object.keys(f).length>0&&n(b[e]),0===Object.keys(f).length&&delete b[e])}}}if("function"!==typeof d)throw new Error("removeListener only takes instances of Function");var e,f=[];if(this.wildcard){var h="string"===typeof c?c.split(this.delimiter):c.slice();f=g.call(this,null,h,this.listenerTree,0)}else{if(!this._events[c])return this;e=this._events[c],f.push({_listeners:e})}for(var i=0;i<f.length;i++){var j=f[i];if(e=j._listeners,b(e)){for(var k=-1,l=0,m=e.length;l<m;l++)if(e[l]===d||e[l].listener&&e[l].listener===d||e[l]._origin&&e[l]._origin===d){k=l;break}if(k<0)continue;return this.wildcard?j._listeners.splice(k,1):this._events[c].splice(k,1),0===e.length&&(this.wildcard?delete j._listeners:delete this._events[c]),this}(e===d||e.listener&&e.listener===d||e._origin&&e._origin===d)&&(this.wildcard?delete j._listeners:delete this._events[c])}return n(this.listenerTree),this},f.prototype.offAny=function(a){var d,b=0,c=0;if(a&&this._all&&this._all.length>0){for(d=this._all,b=0,c=d.length;b<c;b++)if(a===d[b])return d.splice(b,1),this}else this._all=[];return this},f.prototype.removeListener=f.prototype.off,f.prototype.removeAllListeners=function(a){if(0===arguments.length)return!this._events||d.call(this),this;if(this.wildcard)for(var b="string"===typeof a?a.split(this.delimiter):a.slice(),c=g.call(this,null,b,this.listenerTree,0),e=0;e<c.length;e++){var f=c[e];f._listeners=null}else{if(!this._events||!this._events[a])return this;this._events[a]=null}return this},f.prototype.listeners=function(a){if(this.wildcard){var c=[],e="string"===typeof a?a.split(this.delimiter):a.slice();return g.call(this,c,e,this.listenerTree,0),c}return this._events||d.call(this),this._events[a]||(this._events[a]=[]),b(this._events[a])||(this._events[a]=[this._events[a]]),this._events[a]},f.prototype.listenersAny=function(){return this._all?this._all:[]},"function"===typeof define&&define.amd?define(function(){return f}):"object"===typeof exports?exports.EventEmitter2=f:window.EventEmitter2=f}();